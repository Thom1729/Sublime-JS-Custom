%YAML 1.2
%TAG ! tag:yaml-macros:yamlmacros.lib.extend:
---
!merge
contexts: !merge
  statements: !prepend
    - include: decorator

  class-body-contents: !prepend
    - meta_scope: meta.block.js
    - include: decorator

  decorator:
    - match: '@'
      scope: punctuation.definition.annotation.js
      push:
        - decorator-meta
        - decorator-expression-end
        - decorator-expression-begin

  decorator-meta:
    - meta_scope: meta.annotation.js
    - include: immediately-pop

  decorator-name:
    - match: '{{identifier}}{{left_expression_end_lookahead}}'
      scope: variable.annotation.js
      pop: true

  decorator-expression-end:
    - match: \.
      scope: punctuation.accessor.js
      push:
        - include: decorator-name
        - include: object-property

    - include: left-expression-end

  decorator-expression-begin:
    - include: decorator-name
    - include: expression-begin
