%YAML 1.2
%TAG ! tag:yaml-macros:yamlmacros.lib.extend,yamlmacros.lib.arguments,yamlmacros.lib.include:
---
!merge
contexts: !merge
  expression-begin: !prepend
    - match: (?=(?:styled|css|createGlobalStyle|injectGlobal|keyframes){{identifier_break}})
      set:
        - styled-component-end
        - styled-component-begin

  styled-component-end:
    - match: \.
      scope: punctuation.accessor.dot.js
      push: styled-component-begin

    - match: '`'
      scope: punctuation.definition.string.template.begin
      set: !with
        - include: scope:source.js.css
        - !include_resource Packages/JSCustom/extensions/custom_template_tags/template.yaml

    - include: expression-end

  styled-component-begin:
    - match: '{{identifier}}(?=\s*\()'
      scope: variable.function.js
      pop: true

    - match: '{{identifier}}(?=\s*`)'
      scope: variable.function.tagged-template.js
      pop: true

    - match: '{{identifier}}'
      scope: variable.other.readwrite.js
      pop: true

    - include: else-pop
